import csv
import os
import locale
from time import sleep

games = []

def Save_data(games, filepath):
    try:  #Sparar data till csv fil
        with open(filepath, 'w', newline='') as file:
            fieldnames = ['id', 'name', 'genre', 'rating', 'price', 'short_review', 'long_review']
            writer = csv.DictWriter(file, fieldnames=fieldnames)
            writer.writeheader()
            writer.writerows(games)

    except Exception as error_code:
        print("Fel", error_code)
    return f"OK"

def format_currency(value):
    return locale.currency(value,grouping=True)



    
locale.setlocale(locale.LC_ALL, 'sv_SE.UTF-8')  

def truncate_string(word, length=20):
    if len(word) > length:
        return word[:] + "..."    
    else:
        return word

def list_games(games):
    print("=== Nintendo Games ===")
    header = f"{'#':<6} {'NAMN':<26} {'GENRE':<26} {'RATING':<15} {'PRIS':<15} {'KORT RECENSION':<10}"
    # rader för varje produkt:
    separator = "-" * 110           #linje
   
    #rader för varje produkt:
    rows = []

    for index, game in enumerate(games, 1):
        name = game['name']
        genre = game['genre']
        rating = game['rating']
        price = game['price']
        short_review = truncate_string(game['short_review'])
        
        price = locale.currency(price, grouping=True)
        row = f"{index:<5} {name:<25} {genre:<50} {rating:<14} {price:<10} {short_review:<10}"

        rows.append(row)
    
    # kombinera sidhuvud och rader:
    inventory_table = "\n".join([header, separator] + rows)
    
    return f"{inventory_table}"

def load_data(filename): 
    with open(filename, 'r') as file:       #öppnar en fil med read-rättighet
        reader = csv.DictReader(file)
        for row in reader:
            id = int(row['id'])
            name = row['name']
            genre = row['genre']
            rating = float(row['price'])
            price = float(row['price'])
            
            games.append(
                {                   
                    "id": id,       
                    "name": name,
                    "genre": genre,
                    "rating": rating,
                    "quantity": price
                }
            )

  
def show_detailed_review(game_id, games):
    for game in games:
        if game["id"] == str(game_id):
            print(f"=== {game['name']} ===")
            print(game['long_review'])
            return
    print("Inget spel med det ID:t hittades.")
    
def game_details():
    if __name__ == "__main__":
        games = load_games()
        list_games(games)               # visar kort info för alla spel
        idx = int(input("Ange spel ID för att se lång recension: "))
        print("\n--- Lång recension för spel ID", {idx}, "---\n")
        show_detailed_review(idx, games)# visar bara lång recension för specifikt spel
        wait = input("\nTryck på Enter för att fortsätta...")
        
def add_game(games):
    print(f"""Vilken produkt vill du lägga till?""")
    name = input("Namn: ")
    genre = input("Genre: ")   
    rating = float(input("Rating: "))
    price = int(input("Pris: "))
    short_review = truncate_string(input("Kort recension: "))
    long_review = input("Lång recension: ")
    games.append({
        "id": len(games) + 1,
        "name": name,
        "genre": genre,
        "rating": rating,
        "short_review": short_review,
        "long_review": long_review,
        "price": price
    })
    Save_data(games, 'db_games.csv')
    print("Sparar produkt...")
    os.system('cls')    
    
load_data('db_games.csv')

while True:
    os.system('cls') 
    list_games(games)
    